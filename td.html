<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Voice Math Practice App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
h1 { margin-top: 0; }
label { display: block; margin-top: 10px; }
select, input, button {
  padding: 8px;
  margin-top: 5px;
  width: 100%;
  max-width: 400px;
}
#question {
  margin-top: 20px;
  font-size: 1.5em;
  font-weight: bold;
}
#feedback {
  margin-top: 10px;
  font-size: 1.2em;
}
.hidden { display: none; }
</style>
</head>
<body>

<h1>Voice Math Practice</h1>

<label>Category</label>
<select id="category">
  <option value="random">Random</option>
  <option value="add">Addition</option>
  <option value="sub">Subtraction</option>
  <option value="mul">Multiplication</option>
  <option value="div">Division</option>
  <option value="rem">Remainder</option>
  <option value="avg">Average</option>
  <option value="pl">Profit & Loss</option>
</select>

<label>Number Range (min â€“ max)</label>
<input type="number" id="min" value="1" />
<input type="number" id="max" value="10" />

<label>Time (minutes)</label>
<input type="number" id="time" value="1" />

<button id="startBtn">Start</button>

<div id="question"></div>
<div id="feedback"></div>

<input type="text" id="answerInput" placeholder="Type answer and press Enter" class="hidden" />

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.lang = 'en-US';

let correctAnswer = null;
let endTime = null;
let listening = false;

const questionDiv = document.getElementById('question');
const feedbackDiv = document.getElementById('feedback');
const answerInput = document.getElementById('answerInput');

function speak(text) {
  const msg = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.speak(msg);
}

function rand(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function generateQuestion() {
  if (Date.now() > endTime) {
    speak("Time over. Session ended.");
    recognition.stop();
    return;
  }

  const catSel = document.getElementById('category').value;
  const min = Number(document.getElementById('min').value);
  const max = Number(document.getElementById('max').value);

  let cat = catSel === 'random'
    ? ['add','sub','mul','div','rem','avg','pl'][rand(0,6)]
    : catSel;

  let a, b, qText;

  switch (cat) {
    case 'add':
      a = rand(min,max); b = rand(min,max);
      correctAnswer = a + b;
      qText = `${a} plus ${b}`;
      break;
    case 'sub':
      a = rand(min,max); b = rand(min,max);
      correctAnswer = a - b;
      qText = `${a} minus ${b}`;
      break;
    case 'mul':
      a = rand(min,max); b = rand(min,max);
      correctAnswer = a * b;
      qText = `${a} multiplied by ${b}`;
      break;
    case 'div':
      b = rand(min,max);
      correctAnswer = rand(min,max);
      a = b * correctAnswer;
      qText = `${a} divided by ${b}`;
      break;
    case 'rem':
      b = rand(min,max);
      correctAnswer = rand(0,b-1);
      a = rand(min,max) * b + correctAnswer;
      qText = `remainder when ${a} is divided by ${b}`;
      break;
    case 'avg':
      a = rand(min,max); b = rand(min,max);
      correctAnswer = (a + b) / 2;
      qText = `average of ${a} and ${b}`;
      break;
    case 'pl':
      a = rand(min,max);
      b = rand(min,max);
      correctAnswer = b - a;
      qText = `profit if cost price is ${a} and selling price is ${b}`;
      break;
  }

  questionDiv.textContent = "Question: " + qText;
  feedbackDiv.textContent = "";
  speak(qText);
}

function checkAnswer(ans) {
  if (Number(ans) === Number(correctAnswer)) {
    feedbackDiv.textContent = "Correct";
    speak("Correct");
  } else {
    feedbackDiv.textContent = "Wrong. Correct answer is " + correctAnswer;
    speak("Wrong. Correct answer is " + correctAnswer);
  }
  setTimeout(generateQuestion, 800);
}

recognition.onresult = (e) => {
  const transcript = e.results[e.results.length - 1][0].transcript.trim();
  const num = transcript.match(/-?\d+(\.\d+)?/);
  if (num) checkAnswer(num[0]);
};

answerInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    checkAnswer(answerInput.value);
    answerInput.value = '';
  }
});

document.getElementById('startBtn').onclick = () => {
  endTime = Date.now() + Number(document.getElementById('time').value) * 60000;
  answerInput.classList.remove('hidden');
  generateQuestion();
  if (!listening) {
    recognition.start();
    listening = true;
  }
};
</script>

</body>
</html>
